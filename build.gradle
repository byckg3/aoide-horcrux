plugins {
    id 'java'
    id 'application'
}

version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    implementation "com.h2database:h2:1.4.200"
    implementation 'javax.servlet:javax.servlet-api:4.0.1'
    
    // https://mvnrepository.com/artifact/org.hibernate.orm/hibernate-core
    implementation group: 'org.hibernate.orm', name: 'hibernate-core', version: '6.0.0.Alpha7'

    // https://mvnrepository.com/artifact/org.hibernate.orm/hibernate-c3p0
    implementation group: 'org.hibernate.orm', name: 'hibernate-c3p0', version: '6.0.0.Alpha7'

    // https://mvnrepository.com/artifact/javax.validation/validation-api
    implementation 'javax.validation:validation-api:2.0.1.Final'

    // https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator
    runtimeOnly 'org.hibernate.validator:hibernate-validator:6.2.0.Final'
    
    // https://mvnrepository.com/artifact/org.glassfish/javax.el
    runtimeOnly 'org.glassfish:javax.el:3.0.1-b12'

    // https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core
    implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.14.1'

    // https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api
    implementation group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.14.1'

    testImplementation "org.junit.jupiter:junit-jupiter:5.7.0"
}

compileJava.options.encoding = 'UTF-8'

// application {
//     mainClass = 'aoide.model.member.MemberService'
// }

sourceSets {
    // compiling with the groovy plugin will also compile the java classes
    main {
        java {
            srcDirs = [ "src/main/java" ]
        }
        resources {
            srcDirs = [ "src/main/resources" ]
        }
    }
    test {
        java {
            srcDirs = [ 'src/test/java' ]
        }
        resources {
            srcDirs = [ "src/test/resources" ]
        }
    }
}

test {
    // enable JUnit Platform (a.k.a. JUnit 5) support
    useJUnitPlatform {
        // includeTags 'commandOption'
    }
    // show standard out and standard error of the test JVM(s) on the console
    testLogging {
        showStandardStreams = true
        events 'PASSED', 'FAILED', 'SKIPPED'
    }
    // Fail the 'test' task on the first test failure
    failFast = true

    afterSuite { desc, result ->
        if ( !desc.parent ) {
            println "\nTest result: ${result.resultType}"
            println "Test summary: ${result.testCount} tests, " +
                    "${result.successfulTestCount} passed, " +
                    "${result.failedTestCount} failed, " +
                    "${result.skippedTestCount} skipped"
        }
    }
}

task deploy( type: Exec ) {

    commandLine 'cmd', 'xcopy W:\\aoide-split\\webapp W:\\apache-tomcat-10.0.2\\webapps\\aoide /S'
    commandLine 'cmd', 'xcopy W:\\aoide-split\\build\\classes\\java\\main W:\\apache-tomcat-10.0.2\\webapps\\aoide\\WEB-INF\\classes /S'
}